<!-- extend from about base layout -->
{% extends "templates/site.html" %} 

{% block title %}: 

{% trans %}Partido:  {% endtrans %}{{ partidos.name_pt }}

{% endblock %} {% block body %}


<div id="container">


<div class="col-md-3 sidePolitico"> 
    <div id="guide_title">{% trans %}Veja mais{% endtrans %}</div>
	    
	    <a onclick="slide(this.id)" id="app0" class="app_links decision short icon tree_map">
	{% trans %}Informações Gerais{% endtrans %}</a>
		
	<a onclick="slide(this.id)" id="app1" class="app_links decision short icon tree_map">
	
{% trans %}Participação do partido em todo campeonato{% endtrans %}</a>
	
	<a onclick="slide(this.id)" id="app2" class="app_links decision short icon tree_map">
	 {% trans %}Desempenho do partido na última rodada{% endtrans %}</a>
	 
	 
	 	<a onclick="slide(this.id)" id="app3" class="app_links decision short icon tree_map">
	 {% trans %}Dados dos políticos{% endtrans %}</a>
	 
	 	<a onclick="slide(this.id)" id="app4" class="app_links decision short icon tree_map">
	 {% trans %}Proposições{% endtrans %}</a>

</div>

<div class="col-md-9 ctPolitico"> 


	<div id="profile0" class="lightbox guide_app infoQd" style="width: 100%!important; height: auto;">	
		<h1 id="app{{ partidos.id }}">{{ partidos.name_pt }} 
		</h1>
		
		<h2> {{	partidos.sigla }}</h2>
		
		
				<div style=" float: left;
		    height: 70px;
		    width: 100%;" >
			<br /></div>
	</div>
		
	<div id="profile1" class="lightbox guide_app biografia profile_partido"

		style="">
		<h2>{% trans %}Participação do partido em todo campeonato{% endtrans %}</h2>
		
				{% set iframeId = 'iframe1' %}
			{% include "grafico/painel.html" %}
			
			
		<iframe id="iframe1" alt="/grafico/stacked/{{ partidos.id }}"
			style="width: 100%; height: 500px"></iframe>
		
		
				<div style=" float: left;
		    height: 70px;
		    width: 100%;" >
			<br /></div>
	</div>		
	
	
	<div id="profile2" class="lightbox guide_app profile_partido">
	<h2>{% trans %}Desempenho do partido na última rodada{% endtrans %}</h2>
	
			
			{% set iframeId = 'iframe2' %}
			 {% set anoOption = 'false' %}
		  {% set funcOption = 'true' %}
		{% include "grafico/painel.html" %}
			
			
		<iframe id="iframe2" alt="/grafico/treemap/{{ partidos.id }}"
			style="width: 100%; height: 500px"></iframe>
	</div>


	<div id="profile3" class="lightbox guide_app profile_partido">
		<h2>{% trans %}Dados dos políticos{% endtrans %}</h2>
				
			{% set iframeId = 'iframe3' %}
			{% include "grafico/painel.html" %}
				
				
			<iframe id="iframe3" alt="/grafico/bubbles/{{ partidos.id }}"
				style="width: 100%; height: 500px"></iframe>
	</div>
	
	<div id="profile4" class="lightbox guide_app profile_partido">
		<h2>{% trans %}Proposições{% endtrans %}</h2>
								
			<iframe id="iframe4" alt="/proposicao/listar/all/{{ partidos.id }}/true"
				style="width: 100%; height: 500px"></iframe>
	</div>
</div>


	<script>
      
    var width = window.innerWidth-380,
        height = window.innerHeight-149,
        builds = {},
        sliding = false,
        selected = null,
        scrollinterval = null

    d3.selectAll(".guide_app")
      //.style("width",width+"px")
      //.style("height",height+"px")
      .each(function(){ 
        var p = this.id.substring(7),
            t = this.offsetTop-10 //78
        builds[p] = {"loaded": false, "top": t}
       
        if (p == 1) {
          load(p)
          select(p)
        }
      })
   /*   
    window.addEventListener("message",function(msg){
      d3.select("#app"+msg.data.id.substr(6,1))
        .attr("class",function(){
          var c = this.className.split(" ")
          c[4] = msg.data.app
          return c.join(" ")
        })
        .text(msg.data.title)
    })
     */ 
    function slide(id) {
      sliding = true
      var id = id.substring(3)
      scroll(id)
    }

    function load(id) {
      if (!builds[id].loaded) {
        d3.select("#iframe"+id)
          .attr("src",function(){
        	 
            return this.getAttribute("alt")
          })
        builds[id].loaded = true
      }
    }

    function select(id) {
      clearInterval(scrollinterval)
      selected = id
      d3.selectAll(".app_links")
        .attr("class",function(){
          if (this.id.substring(3) == id) return this.className.replace("help","decision")
          else return this.className.replace("decision","help")
        })
    }

    function scroll(id) {
      
      select(id)

      var position = builds[id].top,
          start = window.pageYOffset,
          difference = position - start,
          ticks = 50
          
      var i = 0
      
      function scrollto(){
        var val = Math.easeInOutCubic(i,start,difference,ticks)
        window.scrollTo(0,val)
        
        i++
        if (i == ticks) {
          window.scrollTo(0,position)
          load(id)
          clearInterval(scrollinterval)
          setTimeout(function(){
            sliding = false
          },1000)
        }
      }
      
      scrollinterval = setInterval(scrollto,10)

    }

    Math.easeInOutCubic = function (t, b, c, d) {
    	t /= d/2;
    	if (t < 1) return c/2*t*t*t + b;
    	t -= 2;
    	return c/2*(t*t*t + 2) + b;
    }

    if (Object.keys(builds).length > 1) {
      document.onscroll = function() {
        if (!sliding) {
          var page = window.pageYOffset
          for (b in builds) {
            if(page < ((builds[2].top*(b))-20) && page > ((builds[2].top*(b-2))+20)) {
              if (page+(builds[2].top/2) < builds[b].top+builds[2].top
                  && page+(builds[2].top/2) > builds[b].top && selected != b) {
                    select(b)
                  }
              if (!builds[b].loaded) load(b)
            }
          }
        }
      }

      document.onkeydown = function(e) {
        var trans = null
        if (e.keyCode == 34 || e.keyCode == 39 || e.keyCode == 40) { 
          if (selected < Object.keys(builds).length) trans = parseInt(selected)+1
          else trans = selected
        }
        else if (e.keyCode == 33 || e.keyCode == 37 || e.keyCode == 38) { 
          if (selected > 1) trans = parseInt(selected)-1
          else trans = selected
        }
        else if (e.keyCode == 36) { 
          trans = 1
        }
        else if (e.keyCode == 35) { 
          trans = Object.keys(builds).length
        }
        if (trans) slide("app"+trans)
      };
    }
  </script>
  
  
</div>
{% endblock %}

